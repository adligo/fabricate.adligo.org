#! /bin/sh

# This is the fabricate shell script, to execute fabricate.
# Licensed by Adligo Inc. 
# http://www.apache.org/licenses/LICENSE-2.0

if [ -z "$FABRICATE_HOME" ]; then
    echo "Fabricate requires the FABRICATE_HOME environment variable to be set."
    exit 1
fi
CLASSPATH=$FABRICATE_HOME/lib/commons-logging-1.2.jar
CLASSPATH=$CLASSPATH:$FABRICATE_HOME/lib/httpcore-4.3.2.jar
CLASSPATH=$CLASSPATH:$FABRICATE_HOME/lib/httpclient-4.3.5.jar
CLASSPATH=$CLASSPATH:$FABRICATE_HOME/lib/@FABRICATE_NAME@.jar 

DEBUG=debug
ARGS="$@"
if [ "${ARGS#*$DEBUG}" != "$ARGS" ]; then
		echo "ARGS;" 
		echo "$ARGS"
fi

# @diagram_sync on 1/18/2014 with Overview.seq
# main(String [] args) setup Fabricate args.
ARGS_FROM_SETUP=`java -cp $CLASSPATH org.adligo.fabricate.FabricateSetup args "$@" `
if [ -z "$ARGS_FROM_SETUP" ]; then
    exit 1
fi

IFS=$'\n'
LINES=($ARGS_FROM_SETUP)

if [ "Message" == "${LINES[0]}" ]; then
	
	LINE_COUNT=${#LINES[@]}
	for (( i=1 ; i < ${LINE_COUNT} ; i++ ))
	do
	    echo "${LINES[$i]}"
	done
	exit 0
else
	if [ "${ARGS#*$DEBUG}" != "$ARGS" ]; then
		echo "ARGS_FROM_SETUP;" 
		echo "$ARGS_FROM_SETUP"
	fi
	
	# @diagram_sync on 1/18/2014 with Overview.seq
	# main(String [] args) setup Fabricate opts.
	OPTIONS_FROM_SETUP=`java -cp $CLASSPATH org.adligo.fabricate.FabricateSetup opts "$@" $ARGS_FROM_SETUP`
	if [ -z "$OPTIONS_FROM_SETUP" ]; then
    	exit 1
	fi

	LINES=($OPTIONS_FROM_SETUP)
	if [ "Message" == "${LINES[0]}" ]; then
		LINE_COUNT=${#LINES[@]}
		for (( i=1 ; i < ${LINE_COUNT} ; i++ ))
		do
		    echo "${LINES[$i]}"
		done
		exit 0
	else
		if [ "${ARGS#*$DEBUG}" != "$ARGS" ]; then
			echo OPTIONS_FROM_SETUP are $OPTIONS_FROM_SETUP
		fi
		
		# @diagram_sync on 1/18/2014 with Overview.seq
		# main(String [] args) run Fabricate.
		java  $OPTIONS_FROM_SETUP org.adligo.fabricate.Fabricate "$@" $ARGS_FROM_SETUP 
	fi
fi

